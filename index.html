<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#0b0e14" />
<link rel="manifest" href="manifest.webmanifest" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />
<title>Sets + Finishers</title>
<style>
  :root{
    --bg:#0b0e14; --panel:#111623; --panel-2:#0e1320; --ink:#eaf0f6; --muted:#97a3b3;
    --border:#1f2634; --accent:#57d2b2; --accent-2:#49c6ff; --accent-3:#ffc94f; --accent-4:#ff6ea6;
    --danger:#ef4444; --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background:
      radial-gradient(1200px 800px at 80% -10%, rgba(73,198,255,.08), transparent 60%),
      radial-gradient(1000px 700px at -20% 10%, rgba(255,105,180,.06), transparent 60%),
      linear-gradient(180deg,#0a0f18 0%, #090d14 100%);
    font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    -webkit-font-smoothing:antialiased; line-height:1.45;
  }
  .wrap{max-width:980px;margin:28px auto;padding:16px}
  header{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
  .title{display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px;letter-spacing:.2px}
  .hex{
    width:14px;height:14px;display:inline-block;
    background:linear-gradient(180deg,var(--accent-2),var(--accent));
    clip-path: polygon(25% 0, 75% 0, 100% 50%, 75% 100%, 25% 100%, 0 50%);
    filter: drop-shadow(0 0 6px rgba(73,198,255,.25));
  }
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .pill{display:inline-flex;align-items:center;gap:8px;background:var(--panel-2);border:1px solid var(--border);
    color:var(--ink);border-radius:999px;padding:8px 12px;font-size:13px}
  .pill strong{font-weight:700;color:#fff}
  button,.btn{background:var(--panel-2);border:1px solid var(--border);color:var(--ink);
    border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer;font-size:14px}
  button:hover{border-color:#2d374a}
  .btn-accent{background:linear-gradient(180deg,#16302a,#10231e);border:1px solid #1d3f33}
  .btn-danger{background:linear-gradient(180deg,#2a1316,#1a0c0f);border:1px solid #3a1a20;color:#ffd7d7}

  .panel{background:linear-gradient(180deg,#121727,#101423);border:1px solid var(--border);border-radius:var(--radius);
    box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);overflow:hidden;margin-bottom:16px}
  .panel-head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border)}
  .panel-title{font-weight:800;letter-spacing:.2px}
  .subtle{color:var(--muted);font-size:12px}

  .thead{display:grid;grid-template-columns:220px 1fr 120px;gap:0;border-bottom:1px solid var(--border);
    padding:10px 14px;color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.12em}
  .row{display:grid;grid-template-columns:220px 1fr 120px;gap:0;align-items:center;
    padding:12px 14px;border-bottom:1px dashed #1e2736}
  .row:last-child{border-bottom:none}
  .name{font-weight:700}
  .checks{display:flex;flex-wrap:wrap;gap:8px}
  .check{width:28px;height:28px;display:inline-grid;place-items:center;border-radius:8px;background:#0d1320;border:1px solid var(--border);
    cursor:pointer;user-select:none;transition:transform .06s ease,box-shadow .06s ease,border-color .06s ease}
  .check:hover{border-color:#2b3547}
  .check.checked{background:radial-gradient(100% 100% at 30% 20%, #1b6d53, #124a39);
    border-color:#2a6e54; box-shadow:0 0 0 3px rgba(87,210,178,.18) inset}
  .check input{display:none}
  .mini{font-size:12px;color:var(--muted);text-align:right}

  footer{margin-top:10px;display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between}
  .meter{flex:1;min-width:240px;background:var(--panel);border:1px solid var(--border);border-radius:12px;
    padding:12px 14px;display:grid;gap:10px}
  .bar{height:10px;border-radius:999px;background:#0e1422;border:1px solid var(--border);overflow:hidden}
  .bar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,#49c6ff,#ff6ea6,#57d2b2);transition:width .2s ease}
  .numbers{display:flex;justify-content:space-between;font-weight:800}

  .fin-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .date-ctrl{display:inline-flex;gap:8px;align-items:center;background:var(--panel-2);border:1px solid var(--border);
    border-radius:12px;padding:8px 10px}
  .date-ctrl button{padding:6px 9px;border-radius:10px}
  .date-label{font-weight:700}
  .tag{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--border);background:var(--panel-2);
    border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}
  .tag .dot{width:8px;height:8px;border-radius:50%;background:var(--accent-3);box-shadow:0 0 10px rgba(255,201,79,.35)}
  .tag.active{color:#fff;border-color:#3b3f24;background:linear-gradient(180deg,#2a2b10,#1b1b0a)}
  .tag.active .dot{background:var(--accent-3)}
  @media (max-width:720px){.thead,.row{grid-template-columns:1fr}.mini{text-align:left}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title"><span class="hex"></span> Sets + Finishers</div>
      <div class="controls">
        <div class="pill">Week starting: <strong id="weekLabel"></strong></div>
        <button class="btn" id="prevWeek">Prev</button>
        <button class="btn" id="thisWeek">This Week</button>
        <button class="btn" id="nextWeek">Next</button>
        <button class="btn" id="exportCsv">Export CSV</button>
      </div>
    </header>

    <section class="panel">
      <div class="panel-head">
        <div class="panel-title">Weekly Sets (Body-Part Completion)</div>
        <div class="subtle">Complete all sets for a part to count it for the week.</div>
      </div>
      <div class="thead"><div>Body part</div><div>Sets</div><div>Done</div></div>
      <div id="mainRows"></div>
      <footer>
        <div class="meter">
          <div class="numbers">
            <div><span id="mainDoneCount">0</span>/<span id="mainTotalCount">0</span> body parts</div>
            <div id="mainPctLabel">0%</div>
          </div>
          <div class="bar"><span id="mainBarFill"></span></div>
        </div>
        <button class="btn-danger" id="resetMain">Reset Main</button>
      </footer>
    </section>

    <section class="panel">
      <div class="panel-head">
        <div class="panel-title">Daily Finishers</div>
        <div class="fin-controls">
          <div class="date-ctrl">
            <button class="btn" id="prevDay">◀︎</button>
            <div class="date-label" id="dayLabel"></div>
            <button class="btn" id="nextDay">▶︎</button>
          </div>
          <button class="btn-accent" id="todayBtn">Today</button>
          <span class="subtle">Toggle the gold dot on any finisher to mark it for this date.</span>
        </div>
      </div>
      <div class="thead"><div>Finisher</div><div>Checks</div><div>Today</div></div>
      <div id="finisherRows"></div>
      <footer>
        <div class="meter">
          <div class="numbers">
            <div><span id="finDoneCount">0</span>/<span id="finTotalCount">0</span> checks</div>
            <div id="finPctLabel">0%</div>
          </div>
          <div class="bar"><span id="finBarFill"></span></div>
        </div>
        <button class="btn-danger" id="resetFinishers">Reset Finishers</button>
      </footer>
    </section>
  </div>

<script>
const MAIN_DEFAULTS = [
  { id:"chest",     name:"Chest",     sets:12 },
  { id:"back",      name:"Back",      sets:12 },
  { id:"shoulders", name:"Shoulders", sets:12 },
  { id:"biceps",    name:"Biceps",    sets:12 },
  { id:"triceps",   name:"Triceps",   sets:12 },
  { id:"hamstrings",name:"Hamstrings",sets:12 },
  { id:"quads",     name:"Quads",     sets:12 },
  { id:"calves",    name:"Calves",    sets:12 },
];
const FINISHER_DEFAULTS = [
  { id:"abs",       name:"Abs",        sets:14 },
  { id:"wrists",    name:"Wrists",     sets:14 },
  { id:"neck",      name:"Neck",       sets:18 },
  { id:"f-chest",   name:"Chest",      sets:1  },
  { id:"f-back",    name:"Back",       sets:1  },
  { id:"f-biceps",  name:"Biceps",     sets:1  },
  { id:"f-triceps", name:"Triceps",    sets:7  },
  { id:"f-hams",    name:"Hamstrings", sets:7  },
  { id:"f-quads",   name:"Quads",      sets:7  },
];

function startOfWeek(d=new Date()){ const t=new Date(d.getFullYear(),d.getMonth(),d.getDate());
  const day=(t.getDay()+6)%7; t.setDate(t.getDate()-day); t.setHours(0,0,0,0); return t; }
function addDays(d,n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; }
function fmtISO(d){ return d.toISOString().slice(0,10); }
function fmtWeekLabel(d){ return d.toLocaleDateString(undefined,{month:"short",day:"numeric",year:"numeric"}); }
function fmtDayLabel(d){ return d.toLocaleDateString(undefined,{weekday:"short",month:"short",day:"numeric"}); }

let currentWeek = startOfWeek(new Date());
let selectedDay = new Date();

function keyForWeek(d){ return `sets-tracker-pwa::${fmtISO(startOfWeek(d))}`; }
function loadWeek(d){
  const raw = localStorage.getItem(keyForWeek(d));
  if(!raw){
    return { main:{parts:structuredClone(MAIN_DEFAULTS),checks:{}},
             fin:{parts:structuredClone(FINISHER_DEFAULTS),checks:{}},
             finDaily:{} };
  }
  try{
    const p=JSON.parse(raw);
    if(!p.main) p.main={parts:structuredClone(MAIN_DEFAULTS),checks:{}};
    if(!p.fin)  p.fin ={parts:structuredClone(FINISHER_DEFAULTS),checks:{}};
    if(!p.finDaily) p.finDaily={};
    return p;
  }catch{
    return { main:{parts:structuredClone(MAIN_DEFAULTS),checks:{}},
             fin:{parts:structuredClone(FINISHER_DEFAULTS),checks:{}},
             finDaily:{} };
  }
}
function saveWeek(d,data){ localStorage.setItem(keyForWeek(d), JSON.stringify(data)); }
let weekData = loadWeek(currentWeek);

const weekLabel = document.getElementById('weekLabel');
const mainRowsEl = document.getElementById('mainRows');
const finRowsEl  = document.getElementById('finisherRows');
const mainDoneEl = document.getElementById('mainDoneCount');
const mainTotEl  = document.getElementById('mainTotalCount');
const mainPctEl  = document.getElementById('mainPctLabel');
const mainBarEl  = document.getElementById('mainBarFill');
const finDoneEl  = document.getElementById('finDoneCount');
const finTotEl   = document.getElementById('finTotalCount');
const finPctEl   = document.getElementById('finPctLabel');
const finBarEl   = document.getElementById('finBarFill');
const dayLabelEl = document.getElementById('dayLabel');

function ensureChecks(section, part){
  const store = weekData[section].checks;
  if(!store[part.id]) store[part.id] = Array.from({length: part.sets}, ()=>false);
  const arr = store[part.id];
  if(arr.length < part.sets) for(let i=arr.length;i<part.sets;i++) arr.push(false);
  if(arr.length > part.sets) arr.length = part.sets;
  return arr;
}
function makeCheckbox(val, onToggle){
  const box=document.createElement('label'); box.className='check'+(val?' checked':'');
  const input=document.createElement('input'); input.type='checkbox'; input.checked=val;
  const dot=document.createElement('span'); dot.textContent = val ? '✓' : '';
  input.addEventListener('change', ()=>{ onToggle(input.checked); box.classList.toggle('checked', input.checked); dot.textContent=input.checked?'✓':''; });
  box.addEventListener('click',(e)=>{ if(e.target===box){ input.checked=!input.checked; input.dispatchEvent(new Event('change')); }});
  box.append(input,dot); return box;
}

function buildMain(){
  mainRowsEl.innerHTML='';
  weekData.main.parts.forEach(part=>{
    const arr = ensureChecks('main', part);
    const row=document.createElement('div'); row.className='row';
    const left=document.createElement('div'); left.className='name'; left.textContent=part.name;
    const middle=document.createElement('div'); middle.className='checks';
    arr.forEach((v,i)=>{
      const el=makeCheckbox(v,(checked)=>{ weekData.main.checks[part.id][i]=checked; saveWeek(currentWeek,weekData); updateMainTotals(); updMini(); });
      middle.appendChild(el);
    });
    const right=document.createElement('div'); right.className='mini';
    function updMini(){ const c=(weekData.main.checks[part.id]||[]).filter(Boolean).length; right.textContent=`${c}/${arr.length}`; }
    updMini();
    row.append(left,middle,right);
    mainRowsEl.appendChild(row);
  });
  updateMainTotals();
}
function updateMainTotals(){
  let total=0, done=0;
  weekData.main.parts.forEach(p=>{
    const arr=weekData.main.checks[p.id]||[]; total+=1; if(arr.length>0 && arr.every(Boolean)) done+=1;
  });
  mainTotEl.textContent=total; mainDoneEl.textContent=done;
  const pct = total ? Math.round(done/total*100) : 0; mainPctEl.textContent=pct+'%'; mainBarEl.style.width=pct+'%';
}

function buildFinishers(){
  finRowsEl.innerHTML='';
  const dayISO = fmtISO(selectedDay);
  if(!weekData.finDaily[dayISO]) weekData.finDaily[dayISO] = {};
  const todayMap = weekData.finDaily[dayISO];

  weekData.fin.parts.forEach(part=>{
    const arr = ensureChecks('fin', part);
    const row=document.createElement('div'); row.className='row';
    const left=document.createElement('div'); left.className='name'; left.textContent=part.name;
    const middle=document.createElement('div'); middle.className='checks';
    arr.forEach((v,i)=>{
      const el=makeCheckbox(v,(checked)=>{ weekData.fin.checks[part.id][i]=checked; saveWeek(currentWeek,weekData); updateFinTotals(); });
      middle.appendChild(el);
    });
    const right=document.createElement('div'); right.className='mini';
    const tag=document.createElement('button');
    tag.className='tag'+(todayMap[part.id] ? ' active' : '');
    tag.innerHTML=`<span class="dot"></span> Today`;
    tag.addEventListener('click',()=>{
      todayMap[part.id]=!todayMap[part.id]; tag.classList.toggle('active', todayMap[part.id]);
      row.style.boxShadow = todayMap[part.id] ? 'inset 0 0 0 1px rgba(255,201,79,.25)' : 'none';
      saveWeek(currentWeek,weekData);
    });
    if(todayMap[part.id]) row.style.boxShadow='inset 0 0 0 1px rgba(255,201,79,.25)';
    right.replaceChildren(tag);

    row.append(left,middle,right);
    finRowsEl.appendChild(row);
  });
  updateFinTotals();
}
function updateFinTotals(){
  let t=0,d=0;
  weekData.fin.parts.forEach(p=>{
    const arr=weekData.fin.checks[p.id]||[]; t+=arr.length; d+=arr.filter(Boolean).length;
  });
  finTotEl.textContent=t; finDoneEl.textContent=d;
  const pct = t ? Math.round(d/t*100) : 0; finPctEl.textContent=pct+'%'; finBarEl.style.width=pct+'%';
}

document.getElementById('prevWeek').addEventListener('click',()=>{ currentWeek=addDays(currentWeek,-7); weekData=loadWeek(currentWeek); rebuildAll(); });
document.getElementById('nextWeek').addEventListener('click',()=>{ currentWeek=addDays(currentWeek, 7); weekData=loadWeek(currentWeek); rebuildAll(); });
document.getElementById('thisWeek').addEventListener('click',()=>{ currentWeek=startOfWeek(new Date()); weekData=loadWeek(currentWeek); rebuildAll(); });

document.getElementById('prevDay').addEventListener('click',()=>{ selectedDay=addDays(selectedDay,-1); updateDayLabel(); buildFinishers(); });
document.getElementById('nextDay').addEventListener('click',()=>{ selectedDay=addDays(selectedDay, 1); updateDayLabel(); buildFinishers(); });
document.getElementById('todayBtn').addEventListener('click',()=>{ selectedDay=new Date(); updateDayLabel(); buildFinishers(); });

document.getElementById('resetMain').addEventListener('click',()=>{ if(!confirm('Clear all MAIN checkmarks for this week?')) return;
  Object.keys(weekData.main.checks).forEach(k=>{ weekData.main.checks[k]=weekData.main.checks[k].map(()=>false); });
  saveWeek(currentWeek,weekData); rebuildAll();
});
document.getElementById('resetFinishers').addEventListener('click',()=>{ if(!confirm('Clear all FINISHER checkmarks for this week?')) return;
  Object.keys(weekData.fin.checks).forEach(k=>{ weekData.fin.checks[k]=weekData.fin.checks[k].map(()=>false); });
  saveWeek(currentWeek,weekData); rebuildAll();
});
document.getElementById('exportCsv').addEventListener('click',()=>{
  const start=fmtISO(currentWeek);
  const rows1=[['WeekStart','Section','BodyPart','CheckNumber','Done']];
  weekData.main.parts.forEach(p=>{ (weekData.main.checks[p.id]||[]).forEach((v,i)=>{ rows1.push([start,'Main',p.name.replace(/,/g,' '),String(i+1),v?'1':'0']); }); });
  weekData.fin .parts.forEach(p=>{ (weekData.fin .checks[p.id]||[]).forEach((v,i)=>{ rows1.push([start,'Finisher',p.name.replace(/,/g,' '),String(i+1),v?'1':'0']); }); });
  const rows2=[['Date','BodyPart','HitToday']];
  Object.keys(weekData.finDaily||{}).sort().forEach(date=>{
    const map=weekData.finDaily[date];
    weekData.fin.parts.forEach(p=>{ rows2.push([date,p.name.replace(/,/g,' '), map && map[p.id] ? '1':'0']); });
  });
  const csv = rows1.map(r=>r.join(',')).join('\n') + '\n\n' + rows2.map(r=>r.join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=`sets-${start}.csv`; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url),4000);
});

function updateDayLabel(){ dayLabelEl.textContent = fmtDayLabel(selectedDay); }
function rebuildAll(){ weekLabel.textContent=fmtWeekLabel(currentWeek); updateDayLabel(); buildMain(); buildFinishers(); }
rebuildAll();

if('serviceWorker' in navigator){ window.addEventListener('load',()=>{ navigator.serviceWorker.register('./service-worker.js'); }); }
</script>
</body>
</html>
